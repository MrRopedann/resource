Upgrade = {}
Upgrade.Money = 100000
Upgrade[1] = {ID = 681, Catalyst = 3918, Result = 7127}
Upgrade[2] = {ID = 450, Catalyst = 3919, Result = 7080}
Upgrade[3] = {ID = 451, Catalyst = 3920, Result = 7081}
Upgrade[4] = {ID = 235, Catalyst = 3921, Result = 7082}
Upgrade[5] = {ID = 1, Catalyst = 2, Result = 3}
--100 в 200 
Upgrade[6] = {ID = 2332, Catalyst = 7749, Result = 774}
Upgrade[7] = {ID = 2334, Catalyst = 7749, Result = 771}
Upgrade[8] = {ID = 2338, Catalyst = 7749, Result = 782}
Upgrade[9] = {ID = 2339, Catalyst = 7749, Result = 4278}
Upgrade[10] = {ID = 2336, Catalyst = 7749, Result = 800}
Upgrade[11] = {ID = 2341, Catalyst = 7749, Result = 786}
Upgrade[12] = {ID = 2343, Catalyst = 7749, Result = 793}
Upgrade[13] = {ID = 3601, Catalyst = 7749, Result = 3618}
Upgrade[14] = {ID = 3602, Catalyst = 7749, Result = 3621}
Upgrade[15] = {ID = 3603, Catalyst = 7754, Result = 3667}
Upgrade[16] = {ID = 3604, Catalyst = 7755, Result = 3668}
Upgrade[17] = {ID = 3611, Catalyst = 7753, Result = 3000}
Upgrade[18] = {ID = 3598, Catalyst = 7750, Result = 2997}
Upgrade[19] = {ID = 3599, Catalyst = 7751, Result = 2998}
Upgrade[20] = {ID = 3600, Catalyst = 7752, Result = 2999}
--200 в 400 
Upgrade[21] = {ID = 774, Catalyst = 7684, Result = 4274}
Upgrade[22] = {ID = 771, Catalyst = 7684, Result = 4275}
Upgrade[23] = {ID = 782, Catalyst = 7684, Result = 4277}
Upgrade[24] = {ID = 4278, Catalyst = 7684, Result = 4283}
Upgrade[25] = {ID = 800, Catalyst = 7684, Result = 4276}
Upgrade[26] = {ID = 786, Catalyst = 7684, Result = 4279}
Upgrade[27] = {ID = 793, Catalyst = 7684, Result = 4280}
Upgrade[28] = {ID = 3618, Catalyst = 7684, Result = 4281}
Upgrade[29] = {ID = 3621, Catalyst = 7684, Result = 4282}
Upgrade[30] = {ID = 3667, Catalyst = 7760, Result = 3669}
Upgrade[31] = {ID = 3668, Catalyst = 7672, Result = 3670}
Upgrade[32] = {ID = 3000, Catalyst = 7756, Result = 3615}
Upgrade[33] = {ID = 2997, Catalyst = 7757, Result = 3612}
Upgrade[34] = {ID = 2998, Catalyst = 7758, Result = 3613}
Upgrade[35] = {ID = 2999, Catalyst = 7759, Result = 3614}
--400 в 600
Upgrade[36] = {ID = 4274, Catalyst = 7687, Result = 3619}
Upgrade[37] = {ID = 4275, Catalyst = 7687, Result = 3620}
Upgrade[38] = {ID = 4277, Catalyst = 7687, Result = 3622}
Upgrade[39] = {ID = 4283, Catalyst = 7687, Result = 3623}
Upgrade[40] = {ID = 4276, Catalyst = 7687, Result = 3626}
Upgrade[41] = {ID = 4279, Catalyst = 7687, Result = 3625}
Upgrade[42] = {ID = 4280, Catalyst = 7687, Result = 3624}
Upgrade[43] = {ID = 4281, Catalyst = 7687, Result = 3629}
Upgrade[44] = {ID = 4282, Catalyst = 7687, Result = 3627}
Upgrade[45] = {ID = 3669, Catalyst = 7663, Result = 3630}
Upgrade[46] = {ID = 3670, Catalyst = 7664, Result = 3631}
Upgrade[47] = {ID = 3615, Catalyst = 7665, Result = 3628}
Upgrade[48] = {ID = 3612, Catalyst = 7778, Result = 3632}
Upgrade[49] = {ID = 3613, Catalyst = 7779, Result = 3633}
Upgrade[50] = {ID = 3614, Catalyst = 7780, Result = 3634}
--600 в 800
Upgrade[51] = {ID = 3619, Catalyst = 7689, Result = 3635}
Upgrade[52] = {ID = 3620, Catalyst = 7689, Result = 3636}
Upgrade[53] = {ID = 3622, Catalyst = 7689, Result = 3637}
Upgrade[54] = {ID = 3623, Catalyst = 7689, Result = 3638}
Upgrade[55] = {ID = 3626, Catalyst = 7689, Result = 3641}
Upgrade[56] = {ID = 3625, Catalyst = 7689, Result = 3640}
Upgrade[57] = {ID = 3624, Catalyst = 7689, Result = 3639}
Upgrade[58] = {ID = 3629, Catalyst = 7689, Result = 3644}
Upgrade[59] = {ID = 3627, Catalyst = 7689, Result = 3642}
Upgrade[60] = {ID = 3630, Catalyst = 7790, Result = 3645}
Upgrade[61] = {ID = 3631, Catalyst = 7791, Result = 3646}
Upgrade[62] = {ID = 3628, Catalyst = 7792, Result = 3643}
Upgrade[63] = {ID = 3632, Catalyst = 7793, Result = 3647}
Upgrade[64] = {ID = 3633, Catalyst = 7794, Result = 3648}
Upgrade[65] = {ID = 3634, Catalyst = 7795, Result = 3649}
--800 в 1000
Upgrade[66] = {ID = 3635, Catalyst = 7796, Result = 3650}
Upgrade[67] = {ID = 3636, Catalyst = 7796, Result = 3651}
Upgrade[68] = {ID = 3637, Catalyst = 7796, Result = 3652}
Upgrade[69] = {ID = 3638, Catalyst = 7796, Result = 3653}
Upgrade[70] = {ID = 3641, Catalyst = 7796, Result = 3656}
Upgrade[71] = {ID = 3640, Catalyst = 7796, Result = 3655}
Upgrade[72] = {ID = 3639, Catalyst = 7796, Result = 3654}
Upgrade[73] = {ID = 3644, Catalyst = 7796, Result = 3659}
Upgrade[74] = {ID = 3642, Catalyst = 7796, Result = 3657}
Upgrade[75] = {ID = 3645, Catalyst = 7797, Result = 3660}
Upgrade[76] = {ID = 3646, Catalyst = 7798, Result = 3666}
Upgrade[77] = {ID = 3643, Catalyst = 7799, Result = 3658}
Upgrade[78] = {ID = 3647, Catalyst = 7800, Result = 3662}
Upgrade[79] = {ID = 3648, Catalyst = 7801, Result = 3663}
Upgrade[80] = {ID = 3649, Catalyst = 7802, Result = 3664}
--1000 в 1200
Upgrade[81] = {ID = 3650, Catalyst = 7803, Result = 3583}
Upgrade[82] = {ID = 3651, Catalyst = 7803, Result = 3584}
Upgrade[83] = {ID = 3652, Catalyst = 7803, Result = 3585}
Upgrade[84] = {ID = 3653, Catalyst = 7803, Result = 3586}
Upgrade[85] = {ID = 3656, Catalyst = 7803, Result = 3589}
Upgrade[86] = {ID = 3655, Catalyst = 7803, Result = 3588}
Upgrade[87] = {ID = 3654, Catalyst = 7803, Result = 3587}
Upgrade[88] = {ID = 3659, Catalyst = 7803, Result = 3592}
Upgrade[89] = {ID = 3657, Catalyst = 7803, Result = 3590}
Upgrade[90] = {ID = 3660, Catalyst = 7804, Result = 3593}
Upgrade[91] = {ID = 3666, Catalyst = 7805, Result = 3597}
Upgrade[92] = {ID = 3658, Catalyst = 7806, Result = 3591}
Upgrade[93] = {ID = 3662, Catalyst = 7807, Result = 3594}
Upgrade[94] = {ID = 3663, Catalyst = 7808, Result = 3595}
Upgrade[95] = {ID = 3664, Catalyst = 7809, Result = 3596}
--1200 в 1400
Upgrade[96] = {ID = 3583, Catalyst = 7887, Result = 3751}
Upgrade[97] = {ID = 3584, Catalyst = 7887, Result = 3752}
Upgrade[98] = {ID = 3585, Catalyst = 7887, Result = 3753}
Upgrade[99] = {ID = 3586, Catalyst = 7887, Result = 3754}
Upgrade[100] = {ID = 3589, Catalyst = 7887, Result = 3757}
Upgrade[101] = {ID = 3588, Catalyst = 7887, Result = 3756}
Upgrade[102] = {ID = 3587, Catalyst = 7887, Result = 3755}
Upgrade[103] = {ID = 3592, Catalyst = 7887, Result = 3760}
Upgrade[104] = {ID = 3590, Catalyst = 7887, Result = 3758}
Upgrade[105] = {ID = 3593, Catalyst = 7888, Result = 3761}
Upgrade[106] = {ID = 3597, Catalyst = 7889, Result = 3765}
Upgrade[107] = {ID = 3591, Catalyst = 7890, Result = 3759}
Upgrade[108] = {ID = 3594, Catalyst = 7891, Result = 3762}
Upgrade[109] = {ID = 3595, Catalyst = 7892, Result = 3763}
Upgrade[110] = {ID = 3596, Catalyst = 7893, Result = 3764}

function can_tichun_item(...)
	if arg.n ~= 10 and arg.n ~= 14 then
		SystemNotice(arg[1], "Parameter value illegal."..arg.n)
		return 0
	end
	local Check = 0
	Check = can_tichun_item_main(arg)
	if Check == 1 then
		return 1
	else
		return 0
	end
end
function can_tichun_item_main(Table)
	local Player = 0
	local ItemBag = {}										
	local ItemCount = {}										
	local ItemBagCount = {}										
	local ItemBag_Now = 0
	local ItemCount_Now = 0
	local ItemBagCount_Num = 0
	Player, ItemBag, ItemCount, ItemBagCount, ItemBag_Now, ItemCount_Now, ItemBagCount_Num = Read_Table(Table)
	if ItemCount[0] ~= 1 or ItemCount[1] ~= 1 or ItemBagCount[0] ~= 1 or ItemBagCount[1] ~= 1 then
		SystemNotice(Player,"Equipment quantity illegal.")
		return 0
	end
	local ItemMain = GetChaItem(Player, 2, ItemBag[0])
	local ItemCatalyst = GetChaItem(Player, 2, ItemBag[1])
	local ItemType_mainitem = GetItemType(ItemMain)
	local ItemType_otheritem = GetItemType(ItemCatalyst)
	local ItemMainID = GetItemID(ItemMain)
	local ItemCatalystID = GetItemID(ItemCatalyst)
	local ItemMainID_Lv = GetItemLv(ItemMain)
	local ItemCatalystID_Lv = GetItemLv(ItemCatalyst)
	local MainID = ItemMainID		
	local CatalystID = ItemCatalystID
	if MainID > 5000 then
		MainID = GetItemAttr(ItemMain, ITEMATTR_VAL_FUSIONID)
	end
	local Check = 0
	for i = 1, table.getn(Upgrade), 1 do
		if MainID == Upgrade[i].ID then
			if CatalystID == Upgrade[i].Catalyst then
				Check = 1
			end
		end
	end
	if Check == 0 then
		SystemNotice(Player, "Please use the correct equipment and upgrade stone.")
		return 0		
	end
	if gettichun_money_main(Table) > GetChaAttr(Player, ATTR_GD) then
		SystemNotice(Player, "Insufficient Gold, unable to upgrade equipment.")
		return 0
	end
	return 1
end
function begin_tichun_item(...)
	local Check_Cantichun = 0
	Check_Cantichun = can_tichun_item_main(arg)
	if Check_Cantichun == 0 then
		return 0
	end
	local Player = 0
	local ItemBag = {}											
	local ItemCount = {}											
	local ItemBagCount = {}										
	local ItemBag_Num = 0
	local ItemCount_Num = 0
	local ItemBagCount_Num = 0
	Player, ItemBag, ItemCount, ItemBagCount, ItemBag_Num, ItemCount_Num, ItemBagCount_Num = Read_Table(arg)
	local ItemMain = GetChaItem(Player, 2, ItemBag[0])	
	local ItemCatalyst = GetChaItem(Player, 2, ItemBag[1])	
	local Money_Need = gettichun_money_main(arg)
	TakeMoney(Player, nil, Money_Need)
	Check_TiChun_Item = tichun_item(arg)
	if Check_TiChun_Item == 0  then
		SystemNotice(Player, "Upgrade failed, please check the script.")
	end
	return 1
end
function get_item_tichun_money(...)
	local Money = gettichun_money_main(arg)
	return Money
end
function gettichun_money_main(Table)
	local Player = 0
	local ItemBag = {}										
	local ItemCount = {}										
	local ItemBagCount = {}									
	local ItemBag_Num = 0									
	local ItemCount_Num = 0									
	local ItemBagCount_Num = 0								
	Player, ItemBag, ItemCount, ItemBagCount, ItemBag_Num, ItemCount_Num, ItemBagCount_Num = Read_Table(Table)
	local ItemMain = GetChaItem(Player, 2, ItemBag[0])	
	local ItemMainLv =  GetItemLv(ItemMain)
	local Money_Need = Upgrade.Money * ItemMainLv
	return Money_Need
end
function tichun_item(Table)
	local Player = 0
	local ItemBag = {}										
	local ItemCount = {}										
	local ItemBagCount = {}										
	local ItemBag_Num = 0
	local ItemCount_Num = 0
	local ItemBagCount_Num = 0
	local ItemID_Cuihuaji = 0
	Player, ItemBag, ItemCount, ItemBagCount, ItemBag_Num, ItemCount_Num, ItemBagCount_Num = Read_Table(Table)
	local ItemMain = GetChaItem(Player, 2, ItemBag[0])
	local ItemCatalyst = GetChaItem(Player, 2, ItemBag[1])	
	local ItemType_mainitem = GetItemType(ItemMain)
	local ItemType_otheritem = GetItemType(ItemCatalyst)
	local ItemMainID = GetItemID(ItemMain)
	local ItemCatalystID = GetItemID(ItemCatalyst)
	local ItemMainID_Lv = GetItemLv(ItemMain)
	local ItemCatalystID_Lv = GetItemLv(ItemCatalyst)
	local MainID = ItemMainID		
	local CatalystID = ItemCatalystID
	if MainID > 5000 then
		MainID = GetItemAttr(ItemMain, ITEMATTR_VAL_FUSIONID)
	end
	local Forge = GetItemForgeParam(ItemMain, 1)
	local r1 = 0
	local r2 = 0
	local ItemEnergy = GetItemAttr(ItemMain, ITEMATTR_ENERGY) 
	local ItemQuality = 12
	for k = 1, table.getn(Upgrade) do
		if MainID == Upgrade[k].ID and CatalystID == Upgrade[k].Catalyst then
			if ItemEnergy < 1000 then
				ItemQuality = 2
			elseif ItemEnergy >= 1000 and ItemEnergy < 2000 then
				ItemQuality = 12
			elseif ItemEnergy >= 2000 and ItemEnergy < 3000 then
				ItemQuality = 13
			elseif ItemEnergy >= 3000 and ItemEnergy < 4000 then
				ItemQuality = 14
			elseif ItemEnergy >= 4000 and ItemEnergy < 5000 then
				ItemQuality = 15
			elseif ItemEnergy >= 5000 and ItemEnergy < 6000 then
				ItemQuality = 16
			elseif ItemEnergy >= 6000 and ItemEnergy < 7000 then
				ItemQuality = 17
			elseif ItemEnergy >= 7000 and ItemEnergy < 8000 then
				ItemQuality = 18
			elseif ItemEnergy >= 8000 and ItemEnergy < 9000 then
				ItemQuality = 19
			elseif ItemEnergy >= 9000 and ItemEnergy < 10000 then
				ItemQuality = 20
			end
			MainID = Upgrade[k].Result
			r1,r2 = MakeItem(Player, MainID, 1, ItemQuality)
		end
	end
	local RemMain = 0
	local RemCata = 0
	RemMain = RemoveChaItem(Player, ItemMainID, 1, 2, ItemBag[0], 2, 1, 1)
	RemCata = RemoveChaItem(Player, ItemCatalystID, 1, 2, ItemBag[1], 2, 1, 1)	
	if RemMain == 0 or RemCata == 0 then
		SystemNotice(Player, "Remove item failed.")
		return
	end
	local NewItem = GetChaItem(Player, 2, r2)
	local CheckForge = SetItemForgeParam(NewItem, 1, Forge)
	if CheckForge == 0 then
		SystemNotice(Player, "Fail to set forging attribute settings.")
		return
	end
	--Notice("Congratulations, player "..GetChaDefaultName(Player).." upgraded "..GetItemName(ItemMainID).." with "..GetItemName(ItemCatalystID).." and obtained "..GetItemName(MainID)..".")
	-------------------------------
	--Выводит в ГМ чат кто че улучшил. Внизу переведенная строка мол Поздравляем чел улучшил такую вещь до такой.
	-----------------------------------норм тема это можно применить не только к улучшению) Ну эт первое, что мне в голову пришло.щя вк напишу
	GMNotice("\207\238\231\228\240\224\226\235\255\229\236! \200\227\240\238\234 ["..GetChaDefaultName(Player).."] \243\235\243\247\248\232\235 "..GetItemName(ItemMainID).." \232 \239\238\235\243\247\232\235 "..GetItemName(MainID)..".")
	
	LG("Upgrade System", "Player: ["..GetChaDefaultName(Player).."], Equipment: ["..GetItemName(ItemMainID).."], Catalyst: ["..GetItemName(ItemCatalystID).."], Result: ["..GetItemName(MainID).."]")
	SynChaKitbag(Player, 13)
end
