functions.lua
function PacketHandler(role, rpk, packet_id)

	-- return 1 - продолжить обработку в GameServer, 
	-- return 0 - остановить обработку в GameServer.

	--SystemNotice(role, "Получен пакет № "..packet_id)
	print("Gives Packet: "..packet_id)
	-- Ежедневный приз
	local cha_id = GetRoleID(role)
	if (packet_id == 110) then
	
		local data = ReadData(cha_id)
		local nowDay = tonumber(data["Now Day"])
		
		GiveDeilyGift(role, nowDay)
	
	end
	
	-- Пакет шанса комбайна
	if (packet_id == 107) then
	
		-- Считываем входящий пакет
		local scrollPos = ReadByte(rpk)
		local firstGemPos = ReadByte(rpk)
		local secondGemPos = ReadByte(rpk)
		
		-- Вызываем функцию обработки шанса комбайна
		CombineChance(role, scrollPos, firstGemPos, secondGemPos)
		
		return 0 -- прекращаем обработку в ГС
	
	end
  
	--[[
  
	-- это пакет входящих сообщений в местный чат
	if (packet_id == 1) then
	
		-- Создаем копию пакета (не влияя на основной)
		local clone = ClonePacket(rpk)

		-- Читаем копию пакета
		local message = ReadString(clone)
		
		if (message ~= "&updateall") then
		
			SystemNotice(role, "Вы отправил в местный чат: "..message)
			return 1 -- Блокируем обработку в Гейм Сервере (то есть обработка будет только в этой функции).
		
		end

	end
	
	]]--

	return 1

end



---------------------
-- Панель эффектов --
---------------------
-- Добавляет эффект в панель эффектов
function EffectPanel_Add(role, effect_name, effect_lv, icon_name, work_time)

  local packet = GetPacket()
  WriteCmd( packet, 777 )
  WriteString( packet, effect_name)
  WriteDword( packet, effect_lv )
  WriteString( packet, icon_name)
  WriteDword( packet, work_time )
  SendPacket( role, packet )

end

-- Очищает панель эффектов
function EffectPanel_Clear(role)

  local packet = GetPacket()
  WriteCmd( packet, 778 )
  SendPacket( role, packet )

end

-- Удаляет эффект из панели эффектов персонажа
function EffectPanel_Remove(role, effect_name)

  local packet = GetPacket()
  WriteCmd( packet, REMOVE_EFFECT )
  WriteString( packet, effect_name)
  SendPacket( role, packet )

end

-- Конвертер времени
function EffectPanel_TimeConvertor(time_in_second)

  return (time_in_second * 1000)

end